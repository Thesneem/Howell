<%-include('../user/layouts/user-header.ejs') %>
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">

<!-- Modal -->
<div class="modal fade" id="Return" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <form id="return" method="post" onsubmit="ReturnOrder('<%= orderDetails._id %>');return false">
      <div class="modal-content">
        <div class="modal-header">

          <h5 class="modal-title" id="exampleModalLabel">Return Product</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"> <span
            aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body">
          <label for="reviewId">Write Reason</label><br>
          <textarea name="reason" class="form-control" id="reviewId" cols="30" rows="4" required></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-success" data-dismiss="modal">Close</button>
          <button class="btn btn-danger">Yes</button>
        </div>
    </form>
  </div>
</div>
</div>

<div class="page-holder">
  <div class="container">
    <!-- HERO SECTION-->
    <section class="py-5 bg-secondary">
      <div class="container">
        <div class="row px-4 px-lg-5 py-lg-4 align-items-center">
          <div class="col-lg-6">
            <h1 class="h2 text-uppercase mb-0">VIew details</h1>
          </div>
          <div class="col-lg-6 text-lg-end">
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb justify-content-lg-end mb-0 px-0 bg-secondary">
                <li class="breadcrumb-item"><a class="text-dark" href="/">Home</a></li>
                <li class="breadcrumb-item"><a class="text-dark" href="/">Profile</a></li>
                <li class="breadcrumb-item"><a class="text-dark" href="/orderHistory">Order history</a></li>
                <li class="breadcrumb-item active" aria-current="page">View details</li>
              </ol>
            </nav>
          </div>
        </div>
      </div>
    </section>

    <div class="page-content">

      <div class="widget-content widget-content-area add-manage-product-2 container mt-3">
        <div class="row ">

          
          <!-- <div class="col-md-2 ">
            <div class="card card-default " style="border-color: white !important; color: black !important;">

              <div class="card border-0 ad-box-shadow p-0 ">

                <div class="card-body col-sm-112">
                  


                  <div id="dragged_images">
                  </div>
                  

                <
          </div> -->
          <!-- <h5 class="text-danger text-center border border-danger">canceled</h5> -->

          
          <div class=" col-md-12 ">

            <div class="admincard card card-default" style="border-color: white !important;">

              <div class="card-body ">
                <div class="card-body d-flex">
                  <div class="card p-3 bg-light my-2 col-lg-6" id="item">
                    <div class="d-flex justify-content-between">
                      <h6>Address </h6>
                    </div>
                    <div class="col-md-4">
                      <p id="p"><b><%=orderDetails.address.addressName%></b>,<br>&nbsp;<%=orderDetails.address.House%>,<%=orderDetails.address.city%> <br><%=orderDetails.address.district%>,<%=orderDetails.address.state%><br><%=orderDetails.address.Pin%></p>
                    </div>
                  </div>

                  <div class="card p-3 bg-light my-2 col-lg-6 text-center" id="item">
                    <div class="d-flex justify-content-center">
                      <h6 class="fw-bold text-success">Coupon Details</h6>
                    </div>
                    <div class="text-center ">
                      <% if(orderDetails.coupon.discount !== 0){%>
 
                      <p>Coupon Name:<%=orderDetails.coupon.name%><b></b></p>
                      <p>Coupon code:<%=orderDetails.coupon.code%> </p>
                      <p>Coupon discount:<%=orderDetails.coupon.discount%></p>
                      <%} else{%>
                      <h3 class="mt-4">No Coupon</h3>
                      <%}%>
                    </div>
                  </div>
                </div>

                <div class="card-body ">


                  <div class="table-responsive mb-4 border border-2 border-black">
                    <table class="table text-nowrap">
                      <thead class="bg-secondary">
                        <tr>
                          <th class="border-0 p-3 ps-5" scope="col"> <strong class="text-sm text-uppercase">Product</strong></th>
                          <th class="border-0 p-3" scope="col"> <strong class="text-sm text-uppercase">Name</strong></th>
                          <th class="border-0 p-3" scope="col"> <strong class="text-sm text-uppercase">Quantity</strong></th>
                          <th class="border-0 p-3" scope="col"> <strong class="text-sm text-uppercase">Price</strong></th>
                          <th class="border-0 p-3 " scope="col"> <strong class="text-sm text-uppercase">Total</strong></th>
                          <th class="border-0 p-3 " scope="col"> <strong class="text-sm text-uppercase"></strong></th>

                          
                          <!-- <th class="border-0 p-3 text-center" scope="col"> <strong class="text-sm text-uppercase">Review</strong></th> -->
                          

                        </tr>
                      </thead>
                      <tbody class="border-0">
                        <% orderDetails.products.forEach((item)=>{ %>

                        <tr id="">
                          <th class="ps-0 py-3 border-light ps-5" scope="row">
                            <div class="d-flex align-items-center "><a class="reset-anchor d-block animsition-link " href=""><img src="/admin/images/<%=item.product_id.image[0]%>" alt="ProductDetials" width="70" /></a>
                            </div>
                          </th>
                          <th class="ps-0 py-3 border-light align-middle" scope="row">
                            <div class="ms-3"><strong class="h6"><a class="reset-anchor animsition-link" href="">
                                  <%= item.name%>
                                </a></strong></div>
                          </th>
                          <td class="p-3 align-middle border-light">
                            <p class="mb-0 small"><span>
                              <%=item.qnty%>
                              </span></p>
                          </td>
                          <td class="p-3 align-middle border-light">
                            <p class="mb-0 small">$<span>
                                <%=item.price%>
                              </span></p>
                          </td>
                          <td class="p-3 align-middle border-light ps-5 ">

                            <p class="mb-0 small">$<span>
                              <%=item.qnty * item.price%>
                              </span></p> 
                             
                          </td>
                          <td class="p-3 align-middle border-light ps-5"> <a href="/invoice/<%=orderDetails._id%>"><i class="bi bi-receipt"></i></a>
                          </td>

                          <!-- <td class="p-3 align-middle border-light">
                            <button type="button " class="badge " data-bs-toggle="modal" data-bs-target="#exampleModalre" onclick="">
                              <i class="bi bi-stars text-warning"></i>
                            </button>

                          </td> -->

                        

                        </tr>
                        
                         <%})%> 
                      </tbody>
                    </table>
                    <!-- couponbillamount -->
                    <div>
                      <% if(orderDetails.coupon.discount !== 0){%>
                        <h6>GrandTotal with Discount:$<span class="text-primary"><%=orderDetails.bill_amount%></span></h6>
                        <%}%>
                    </div>
                  </div>


                </div>
                <!-- Order Status -->
                <!-- <% let delstatus = orderDetails.delivery_status;
                console.log(delstatus) %>  -->
                <!-- <h5 class="text-danger text-center border border-danger">Ordered</h5> -->

                <% if (orderDetails.delivery_status.ordered.state == true && orderDetails.delivery_status.canceled.state == false && orderDetails.delivery_status.shipped.state == false && orderDetails.delivery_status.out_for_delivery.state == false && orderDetails.delivery_status.delivered.state == false && orderDetails.delivery_status.returned.state == false){ %>
                <h5 class="text-black text-center border border-black mb-2">Ordered</h5>
                <%} else if (orderDetails.delivery_status.ordered.state == true && orderDetails.delivery_status.canceled.state == false && orderDetails.delivery_status.shipped.state == true && orderDetails.delivery_status.out_for_delivery.state == false && orderDetails.delivery_status.delivered.state == false && orderDetails.delivery_status.returned.state == false){ %>

                <h5 class="text-primary text-center border border-primary mb-2">Shipped</h5>
                <%} else if (orderDetails.delivery_status.ordered.state == true && orderDetails.delivery_status.canceled.state == false && orderDetails.delivery_status.shipped.state == true && orderDetails.delivery_status.out_for_delivery.state == true && orderDetails.delivery_status.delivered.state == false && orderDetails.delivery_status.returned.state == false){ %>
                  <h5 class="text-info text-center border border-info mb-2">Out for Delivery</h5>

                
                  <% } %>
                <!-- Order status -->
                 <%  if(orderDetails.delivery_status.canceled.state==true){ %>

                <h5 class="text-danger text-center border border-danger">canceled</h5>
                <% }else if(orderDetails.delivery_status.delivered.state==false){ %>


                <div id="cancel" class="text-end me-3">
                  <!-- Button trigger modal -->
                  <button type="button" class="btn btn-danger " data-toggle="modal" data-target="#exampleModal">
                    Cancel Order
                  </button>
                </div>
                <% }else if(orderDetails.delivery_status.returned.state==false){ %>

                <div class="d-flex justify-content-lg-end mb-3">
                  <button type="button" class="btn btn-danger ms-2" data-toggle="modal" data-target="#Return">
                    Return
                  </button>
                </div>
               

                <h5 class="text-success mt-2 text-center border border-success">Order delivered</h5>
                <% } %>
                <!-- Modal -->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h3 class="modal-title fs-5 " id="exampleModalLabelcancel">Cancel order</h3>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                          aria-hidden="true">&times;</span></button>
                      </div>
                      <div class="modal-body">
                        Are you sure want to cancel this order
                      </div>
                      <div class="modal-footer">`
                        <button type="button" class="btn btn-success" data-bs-dismiss="modal">NO</button>
                        <button type="button" class="btn btn-danger" onclick="cancelOrder('<%= orderDetails._id %>');return false">Yes</button>
                      </div>
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function cancelOrder(id) {
  $.ajax({
    type: "POST",
    url: "/cancelOrder",
    data: {
      id,
    },
    dataType: "json",
    encode: true,
  }).done(function (data) {
    if (data == "OrderCanceled") {
      Swal.fire("Canceled!", "This Order has been canceled and Your Wallet has been updated", "success");
      resHTML =
        '<h5 class="text-success text-center border border-success">Order canceled</h5>';
      $("#cancel").html(resHTML);
    }
  });
}
</script>
<script>
  function ReturnOrder(id) {
  $.ajax({
    type: "POST",
    url: "/returnOrder/" + id,
    data: $("#Return").serialize(),
    dataType: "json",
    encode: true,
  }).done(function (data) {
    if (data == "Success") {
      Swal.fire(
        "Returned!",
        "We will get back to you soon",
        "success"
      );
    }
  });
}
</script>
<%-include('../user/layouts/user-footer.ejs') %>
